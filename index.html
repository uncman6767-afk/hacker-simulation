<!DOCTYPE html>
<html>
<head>
  <title>3D Car Demo</title>
  <style>
    body { margin:0; overflow:hidden; }
    canvas { display:block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js"></script>

<script>
// === Scene Setup ===
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// === Physics World ===
const world = new CANNON.World();
world.gravity.set(0,-9.82,0);

// === Ground ===
const groundBody = new CANNON.Body({ type:CANNON.Body.STATIC });
groundBody.addShape(new CANNON.Plane());
groundBody.quaternion.setFromEuler(-Math.PI/2,0,0);
world.addBody(groundBody);

const groundMesh = new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshPhongMaterial({color:0x228B22})
);
groundMesh.rotation.x = -Math.PI/2;
scene.add(groundMesh);

// === Lights ===
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(20,50,20);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// === Car Body ===
const carBody = new CANNON.Body({ mass:1500 });
carBody.addShape(new CANNON.Box(new CANNON.Vec3(1,0.5,2)));
carBody.position.set(0,2,0);
world.addBody(carBody);

const carMesh = new THREE.Mesh(
  new THREE.BoxGeometry(2,1,4),
  new THREE.MeshPhongMaterial({color:0xff0000})
);
scene.add(carMesh);

// === Wheels ===
const wheels = [];
const wheelMeshes = [];
const wheelPositions = [
  [1,-0.5,1.5],
  [-1,-0.5,1.5],
  [1,-0.5,-1.5],
  [-1,-0.5,-1.5]
];

wheelPositions.forEach(pos=>{
  const wheelBody = new CANNON.Body({ mass:50, shape: new CANNON.Sphere(0.5) });
  wheelBody.position.set(carBody.position.x+pos[0], carBody.position.y+pos[1], carBody.position.z+pos[2]);
  world.addBody(wheelBody);
  wheels.push(wheelBody);

  const wheelMesh = new THREE.Mesh(
    new THREE.SphereGeometry(0.5,16,16),
    new THREE.MeshPhongMaterial({color:0x333333})
  );
  scene.add(wheelMesh);
  wheelMeshes.push(wheelMesh);
});

// === Controls ===
const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// === Animation Loop ===
function animate(){
  requestAnimationFrame(animate);

  const force = 5000;
  if(keys['w']) carBody.applyForce(new CANNON.Vec3(0,0,-force), carBody.position);
  if(keys['s']) carBody.applyForce(new CANNON.Vec3(0,0,force), carBody.position);
  if(keys['a']) carBody.quaternion.setFromEuler(0,carBody.quaternion.toEuler().y+0.03,0);
  if(keys['d']) carBody.quaternion.setFromEuler(0,carBody.quaternion.toEuler().y-0.03,0);

  world.step(1/60);

  // Sync car
  carMesh.position.copy(carBody.position);
  carMesh.quaternion.copy(carBody.quaternion);

  // Sync wheels
  wheels.forEach((w,i)=>{
    wheelMeshes[i].position.copy(w.position);
    wheelMeshes[i].quaternion.copy(w.quaternion);
  });

  // Camera follow
  const camOffset = new THREE.Vector3(10,5,10);
  const camPos = carBody.position.clone().vadd(camOffset);
  camera.position.lerp(camPos,0.1);
  camera.lookAt(carBody.position);

  renderer.render(scene,camera);
}

animate();
</script>
</body>
</html>


 
  


